<div class="google-reviews-container" *ngIf="!error || isDevelopment">
  <!-- Loading State -->
  <div *ngIf="loading" class="loading-state">
    <div class="loading-spinner"></div>
    <p>Cargando reviews desde archivo local...</p>
    <small>Los datos se actualizan ejecutando el script de web scraping</small>
  </div>

  <!-- Error State - Solo en desarrollo -->
  <div *ngIf="error && !loading && isDevelopment" class="error-state">
    <div class="error-icon">⚠️</div>
    <h3>No se pudieron cargar las reviews</h3>
    <p>
      No se pudo cargar el archivo JSON con las reviews. Esto puede deberse a:
    </p>
    <ul class="error-reasons">
      <li>El archivo JSON no existe o está corrupto</li>
      <li>No se ha ejecutado el script de web scraping</li>
      <li>Problemas de permisos de archivo</li>
    </ul>
    <button (click)="retry()" class="retry-button">Intentar de nuevo</button>
    <small class="error-note">
      Ejecuta "npm run scrape-reviews" para actualizar los datos
    </small>
  </div>

  <!-- Content -->
  <div *ngIf="!loading && !error" class="reviews-content">
    <!-- Business Info Header -->
    <div *ngIf="businessInfo" class="business-info">
      <div class="business-header">
        <img
          src="assets/images/logo/glow-skin-logo-marron.png"
          alt="Glow Skin Logo"
          class="business-logo"
        />
        <div class="business-details">
          <h3 class="business-name">Glow Skin</h3>
          <p class="business-location">Limpieza Facial en Barranquilla</p>
          <div class="rating-info">
            <span class="stars">{{ generateStars(businessInfo.rating) }}</span>
            <span class="rating-text"
              >{{ businessInfo.rating }} ({{
                businessInfo.totalReviews
              }}
              reseñas)</span
            >
          </div>
        </div>
      </div>
      <div class="business-footer">
        <a
          href="https://www.google.com/maps/place/glow+skin+barranquilla"
          target="_blank"
          rel="noopener noreferrer"
          class="google-link"
        >
          Ver en Google Maps
        </a>
        <small class="last-updated" *ngIf="lastScrapedDate">
          Última actualización: {{ lastScrapedDate | date : "short" }}
        </small>
      </div>
    </div>

    <!-- Reviews Carousel -->
    <div
      *ngIf="reviews.length > 0"
      class="reviews-carousel"
      (mouseenter)="onMouseEnter()"
      (mouseleave)="onMouseLeave()"
    >
      <div class="carousel-header">
        <h4>Reviews de nuestros clientes</h4>
        <p>{{ reviews.length }} reviews de Google</p>
      </div>

      <!-- Carousel Container -->
      <div class="carousel-container">
        <!-- Review Cards -->
        <div class="review-cards">
          <div
            *ngFor="let review of reviews; let i = index"
            class="review-card"
            [class.active]="i === currentReviewIndex"
            [class.prev]="
              i === (currentReviewIndex - 1 + reviews.length) % reviews.length
            "
            [class.next]="i === (currentReviewIndex + 1) % reviews.length"
          >
            <div class="review-header">
              <div class="reviewer-info">
                <div class="reviewer-avatar">
                  <img
                    *ngIf="review.profile_photo_url"
                    [src]="review.profile_photo_url"
                    [alt]="review.author_name"
                    class="avatar-image"
                  />
                  <div
                    *ngIf="!review.profile_photo_url"
                    class="avatar-placeholder"
                  >
                    {{ getAuthorInitials(review.author_name) }}
                  </div>
                </div>
                <div class="reviewer-details">
                  <h5 class="reviewer-name">{{ review.author_name }}</h5>
                  <span class="review-date">{{
                    formatRelativeTime(review.relative_time_description)
                  }}</span>
                </div>
              </div>
              <div class="review-rating">
                <span class="stars">{{ generateStars(review.rating) }}</span>
              </div>
            </div>

            <div class="review-content">
              <p class="review-text">{{ review.text }}</p>
            </div>
          </div>
        </div>

        <!-- Navigation Arrows -->
        <button
          *ngIf="hasMultipleReviews"
          class="carousel-arrow carousel-arrow-prev"
          (click)="prevReview()"
          aria-label="Review anterior"
        >
          <svg
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M15 18L9 12L15 6"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
          </svg>
        </button>

        <button
          *ngIf="hasMultipleReviews"
          class="carousel-arrow carousel-arrow-next"
          (click)="nextReview()"
          aria-label="Review siguiente"
        >
          <svg
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M9 18L15 12L9 6"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
          </svg>
        </button>
      </div>

      <!-- Carousel Dots -->
      <div *ngIf="hasMultipleReviews" class="carousel-dots">
        <button
          *ngFor="let review of reviews; let i = index"
          class="carousel-dot"
          [class.active]="i === currentReviewIndex"
          (click)="goToReview(i)"
          [attr.aria-label]="'Ir a review ' + (i + 1)"
        ></button>
      </div>

      <!-- View All Reviews Link -->
      <div class="view-all-reviews">
        <a
          href="https://www.google.com/maps/place/glow+skin+barranquilla"
          target="_blank"
          rel="noopener noreferrer"
          class="view-all-link"
        >
          Ver todas las reviews en Google
        </a>
      </div>
    </div>

    <!-- No Reviews State -->
    <div *ngIf="reviews.length === 0 && !loading" class="no-reviews">
      <p>No hay reviews disponibles en este momento.</p>
    </div>
  </div>
</div>
